"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[724],{28724:(o,e,t)=>{t.r(e),t.d(e,{default:()=>I});var n=t(55411);const i={CT:"ctToolGroup",PT:"ptToolGroup",Fusion:"fusionToolGroup",MIP:"mipToolGroup",default:"default"};const a=function(o,e,t,n,a){!function(o,e,t,n,a){const l={active:[{toolName:o.WindowLevel,bindings:[{mouseButton:e.MouseBindings.Primary}]},{toolName:o.Pan,bindings:[{mouseButton:e.MouseBindings.Auxiliary}]},{toolName:o.Zoom,bindings:[{mouseButton:e.MouseBindings.Secondary}]},{toolName:o.StackScrollMouseWheel,bindings:[]}],passive:[{toolName:o.Length},{toolName:o.ArrowAnnotate,configuration:{getTextCallback:(o,e)=>{a?o(" "):n.runCommand("arrowTextCallback",{callback:o,eventDetails:e})},changeTextCallback:(o,e,t)=>{void 0===a&&n.runCommand("arrowTextCallback",{callback:t,data:o,eventDetails:e})}}},{toolName:o.Bidirectional},{toolName:o.DragProbe},{toolName:o.Probe},{toolName:o.EllipticalROI},{toolName:o.RectangleROI},{toolName:o.StackScroll},{toolName:o.Angle},{toolName:o.CobbAngle},{toolName:o.Magnify}],enabled:[{toolName:o.SegmentationDisplay}],disabled:[{toolName:o.Crosshairs,configuration:{viewportIndicators:!1,disableOnPassive:!0,autoPan:{enabled:!1,panSize:10}}}]};t.createToolGroupAndAddTools(i.CT,l),t.createToolGroupAndAddTools(i.PT,{active:l.active,passive:[...l.passive,{toolName:"RectangleROIStartEndThreshold"}],enabled:l.enabled,disabled:l.disabled}),t.createToolGroupAndAddTools(i.Fusion,l),t.createToolGroupAndAddTools(i.default,l);const s={active:[{toolName:o.VolumeRotateMouseWheel,configuration:{rotateIncrementDegrees:5}},{toolName:o.MipJumpToClick,configuration:{toolGroupId:i.PT},bindings:[{mouseButton:e.MouseBindings.Primary}]}],enabled:[{toolName:o.SegmentationDisplay},{toolName:o.OrientationMarker,configuration:{orientationWidget:{viewportCorner:"BOTTOM_LEFT"}}}]};t.createToolGroupAndAddTools(i.MIP,s)}(o,e,t,n,a)},{windowLevelPresets:l}=n.defaults,s={commandName:"setToolActiveToolbar",commandOptions:{toolGroupIds:[i.CT,i.PT,i.Fusion]}},r=[{id:"MeasurementTools",uiType:"ohif.splitButton",props:{groupId:"MeasurementTools",primary:n.ToolbarService.createButton({id:"Length",icon:"tool-length",label:"Length",tooltip:"Length Tool",commands:s,evaluate:"evaluate.cornerstoneTool"}),secondary:{icon:"chevron-down",tooltip:"More Measure Tools"},items:[n.ToolbarService.createButton({id:"Bidirectional",icon:"tool-bidirectional",label:"Bidirectional",tooltip:"Bidirectional Tool",commands:s,evaluate:"evaluate.cornerstoneTool"}),n.ToolbarService.createButton({id:"ArrowAnnotate",icon:"tool-annotate",label:"Arrow Annotate",tooltip:"Arrow Annotate Tool",commands:s,evaluate:"evaluate.cornerstoneTool"}),n.ToolbarService.createButton({id:"EllipticalROI",icon:"tool-ellipse",label:"Ellipse",tooltip:"Ellipse Tool",commands:s,evaluate:"evaluate.cornerstoneTool"})]}},{id:"Zoom",uiType:"ohif.radioGroup",props:{icon:"tool-zoom",label:"Zoom",commands:s,evaluate:"evaluate.cornerstoneTool"}},{id:"WindowLevel",uiType:"ohif.radioGroup",props:{icon:"tool-window-level",label:"Window Level",commands:s,evaluate:"evaluate.cornerstoneTool"}},{id:"Crosshairs",uiType:"ohif.radioGroup",props:{icon:"tool-crosshair",label:"Crosshairs",commands:s,evaluate:"evaluate.cornerstoneTool"}},{id:"Pan",uiType:"ohif.radioGroup",props:{icon:"tool-move",label:"Pan",commands:s,evaluate:"evaluate.cornerstoneTool"}},{id:"RectangleROIStartEndThreshold",uiType:"ohif.radioGroup",props:{icon:"tool-create-threshold",label:"Rectangle ROI Threshold",commands:s,evaluate:{name:"evaluate.cornerstoneTool",disabledText:"Select the PT Axial to enable this tool"},options:"tmtv.RectangleROIThresholdOptions"}}],d=JSON.parse('{"UU":"@ohif/mode-tmtv"}').UU;var c=t(92344);const{MetadataProvider:u}=n.classes,m="@ohif/extension-default.layoutTemplateModule.viewerLayout",p="@ohif/extension-default.sopClassHandlerModule.stack",T="@ohif/extension-default.panelModule.seriesList",g="@ohif/extension-cornerstone.viewportModule.cornerstone",v="@ohif/extension-cornerstone-dicom-seg.panelModule.panelSegmentation",h="@ohif/extension-tmtv.hangingProtocolModule.ptCT",b="@ohif/extension-tmtv.panelModule.petSUV",f="@ohif/extension-tmtv.panelModule.tmtvBox",S="@ohif/extension-tmtv.panelModule.tmtvExport",M={"@ohif/extension-default":"^3.0.0","@ohif/extension-cornerstone":"^3.0.0","@ohif/extension-cornerstone-dicom-seg":"^3.0.0","@ohif/extension-tmtv":"^3.0.0"};let y=[];const I={id:d,modeFactory:function({modeConfiguration:o}){return{id:d,routeName:"tmtv",displayName:c.A.t("Modes:Total Metabolic Tumor Volume"),onModeEnter:({servicesManager:o,extensionManager:e,commandsManager:t})=>{const{toolbarService:n,toolGroupService:l,customizationService:s,hangingProtocolService:d,displaySetService:c,viewportGridService:m}=o.services,p=e.getModuleEntry("@ohif/extension-cornerstone.utilityModule.tools"),{toolNames:T,Enums:g}=p.exports;a(T,g,l,t);const{unsubscribe:v}=l.subscribe(l.EVENTS.VIEWPORT_ADDED,(()=>{const{displaySetMatchDetails:o}=d.getMatchDetails();!function(o,e,t,n){const a=o.get("ctDisplaySet");if(!a)return;const{SeriesInstanceUID:l}=a,s=n.getDisplaySetsForSeries(l),r={...t.getToolConfiguration(i.Fusion,e.Crosshairs),filterActorUIDsToSetSlabThickness:[s[0].displaySetInstanceUID]};t.setToolConfiguration(i.Fusion,e.Crosshairs,r)}(o,T,l,c),function(o,e,t,n){const a=o.get("ptDisplaySet");if(!a)return;const{SeriesInstanceUID:l}=a,s=n.getDisplaySetsForSeries(l);if(!s||0===s.length)return;const r=t.getToolConfiguration(i.Fusion,e.WindowLevel),d=t.getToolConfiguration(i.Fusion,e.EllipticalROI),c=`cornerstoneStreamingImageVolume:${s[0].displaySetInstanceUID}`,u={...r,volumeId:c},m={...d,volumeId:c};t.setToolConfiguration(i.Fusion,e.WindowLevel,u),t.setToolConfiguration(i.Fusion,e.EllipticalROI,m)}(o,T,l,c)}));y.push(v),n.addButtons(r),n.createButtonSection("primary",["MeasurementTools","Zoom","WindowLevel","Crosshairs","Pan","SyncToggle"]),n.createButtonSection("ROIThresholdToolbox",["RectangleROIStartEndThreshold"]),s.addModeCustomizations([{id:"segmentation.panel",segmentationPanelMode:"expanded",addSegment:!1,onSegmentationAdd:()=>{t.run("createNewLabelmapFromPT")}}]);const{unsubscribe:h}=m.subscribe(m.EVENTS.VIEWPORTS_READY,(()=>{t.run("setToolEnabled",{toolName:"OrientationMarker",toolGroupId:"mipToolGroup"}),h()}));d.addCustomAttribute("getPTVOIRange","get PT VOI based on corrected or not",(o=>{const e=o.find((o=>"PT"===o.Modality));if(!e)return;const{imageId:t}=e.images[0],n=u.get("scalingModule",t);return n&&n.suvbw?{windowWidth:5,windowCenter:2.5}:void 0}))},onModeExit:({servicesManager:o})=>{const{toolGroupService:e,syncGroupService:t,segmentationService:n,cornerstoneViewportService:i,uiDialogService:a,uiModalService:l}=o.services;y.forEach((o=>o())),a.dismissAll(),l.hide(),e.destroy(),t.destroy(),n.destroy(),i.destroy()},validationTags:{study:[],series:[]},isValidMode:({modalities:o,study:e})=>{const t=o.split("\\");return{valid:t.includes("CT")&&"M1"!==e.mrn&&t.includes("PT")&&!["SM"].some((o=>t.includes(o)))&&"1.3.6.1.4.1.12842.1.1.14.3.20220915.105557.468.2963630849"!==e.studyInstanceUid,description:"The mode requires both PT and CT series in the study"}},routes:[{path:"tmtv",layoutTemplate:()=>({id:m,props:{leftPanels:[T],leftPanelClosed:!0,rightPanels:[[f,v,S],b],viewports:[{namespace:g,displaySetsToDisplay:[p]}]}})}],extensions:M,hangingProtocol:h,sopClassHandlers:[p],hotkeys:[...n.ot.defaults.hotkeyBindings],...o}},extensionDependencies:M}}}]);
//# sourceMappingURL=724.bundle.552bba7b33fce2666956.js.map