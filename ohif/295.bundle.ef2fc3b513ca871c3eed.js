"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[295],{58295:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(11374),s=n.n(r),a=n(41766),o=n(80619),i=n(24914);const l=function(e,t,n){const{tools:r}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,r)},c={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const u=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:r,hydrateSEGDisplaySet:s}){const{uiViewportDialogService:a}=e.services;return new Promise((async function(e,o){const l=await function(e,t){return new Promise((function(n,r){const s="Do you want to open this Segmentation?",a=[{type:i.Ny.NW.secondary,text:"No",value:c.CANCEL},{type:i.Ny.NW.primary,text:"Yes",value:c.HYDRATE_SEG}],o=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:s,actions:a,onSubmit:o,onOutsideClick:()=>{e.hide(),n(c.CANCEL)},onKeyPress:e=>{"Enter"===e.key&&o(c.HYDRATE_SEG)}})}))}(a,n);if(l===c.HYDRATE_SEG){r?.forEach((e=>{e()}));e(await s({segDisplaySet:t,viewportId:n}))}}))};function p({isHydrated:e,onStatusClick:t}){let n=null,r=null;switch(e){case!0:r=()=>a.createElement(i.In,{name:"status-alert"}),n=()=>a.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:r=()=>a.createElement(i.In,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>a.createElement("div",null,"Click LOAD to load segmentation.")}const s=()=>{const{t:n}=(0,o.Bd)("Common"),s=n("LOAD");return a.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},a.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},a.createElement(r,null),a.createElement("span",{className:"ml-1"},"SEG")),!e&&a.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},s))};return a.createElement(a.Fragment,null,n&&a.createElement(i.m_,{content:a.createElement(n,null),position:"bottom-left"},a.createElement(s,null)),!n&&a.createElement(s,null))}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(this,arguments)}function m(e){const{children:t,displaySets:n,viewportOptions:r,servicesManager:s,extensionManager:c,commandsManager:m}=e,{t:S}=(0,o.Bd)("SEGViewport"),E=r.viewportId,{displaySetService:y,toolGroupService:v,segmentationService:g,uiNotificationService:w,customizationService:f,viewportActionCornersService:I}=s.services,b=`SEGToolGroup-${E}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const h=n[0],[D,N]=(0,i.ih)(),[C,T]=(0,a.useState)(1),[A,k]=(0,a.useState)(h.isHydrated),[P,G]=(0,a.useState)(!h.isLoaded),[x,O]=(0,a.useState)(null),[M,L]=(0,a.useState)({percentComplete:null,totalSegments:null}),R=(0,a.useRef)(null),{viewports:_,activeViewportId:U}=D,V=h.getReferenceDisplaySet(),H=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,r=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:s}=r,a=Array.isArray(s)?s[0]:s,{SpacingBetweenSlices:o,SliceThickness:i}=a,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||i,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||o};return c}(V,h);R.current={displaySet:V,metadata:H};const j=()=>{O(null)},F=(0,a.useCallback)((()=>{D?.viewports.forEach((({viewportId:e})=>{m.runCommand("storePresentation",{viewportId:e})}))}),[D]),B=(0,a.useCallback)((()=>{const{component:t}=c.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=R.current;return a.createElement(t,d({},e,{displaySets:[n,h],viewportOptions:{viewportType:"volume",toolGroupId:b,orientation:r.orientation,viewportId:r.viewportId},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{O(e.detail.element)})(t)},onElementDisabled:j}))}),[E,h,b]),Y=(0,a.useCallback)((e=>{const t=h.displaySetInstanceUID,n=g.getSegmentation(t),{segments:r}=n,s=Object.keys(r).length;let a=C+e;a>s-1?a=1:0===a&&(a=s-1),g.jumpToSegmentCenter(t,a,b),T(a)}),[C]);(0,a.useEffect)((()=>{P||u({servicesManager:s,viewportId:E,segDisplaySet:h,preHydrateCallbacks:[F],hydrateSEGDisplaySet:q}).then((e=>{e&&k(!0)}))}),[s,E,h,P]),(0,a.useEffect)((()=>{const{unsubscribe:e}=g.subscribe(g.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.segDisplaySet.displaySetInstanceUID===h.displaySetInstanceUID&&G(!1)}));return()=>{e()}}),[h]),(0,a.useEffect)((()=>{const{unsubscribe:e}=g.subscribe(g.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{L({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[h]),(0,a.useEffect)((()=>{const e=y.subscribe(y.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=_.get(U);e.includes(t.displaySetInstanceUID)&&N.setDisplaySetsForViewport({viewportId:U,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,a.useEffect)((()=>{let e=v.getToolGroup(b);if(!e)return e=l(v,f,b),()=>{g.removeSegmentationRepresentationFromToolGroup(b),v.destroyToolGroup(b)}}),[]),(0,a.useEffect)((()=>(k(h.isHydrated),()=>{g.removeSegmentationRepresentationFromToolGroup(b),R.current=null})),[h]);const q=(0,a.useCallback)((({segDisplaySet:e,viewportId:t})=>{m.runCommand("loadSegmentationDisplaySetsForViewport",{displaySets:[e],viewportId:t})}),[m]),W=(0,a.useCallback)((async()=>{F();const e=await q({segDisplaySet:h,viewportId:E});k(e)}),[q,h,F,E]);(0,a.useEffect)((()=>{I.setComponents([{viewportId:E,id:"viewportStatusComponent",component:p({isHydrated:A,onStatusClick:W}),indexPriority:-100,location:I.LOCATIONS.topLeft},{viewportId:E,id:"viewportActionArrowsComponent",component:a.createElement(i.$I,{key:"actionArrows",onArrowsClick:Y,className:E===U?"visible":"invisible group-hover:visible"}),indexPriority:0,location:I.LOCATIONS.topRight}])}),[U,A,Y,W,I,E]);let $=null;if(!R.current||V.displaySetInstanceUID!==R.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&($=t.map(((e,t)=>e&&a.cloneElement(e,{viewportId:E,key:t}))));const{PatientID:z,PatientName:K,PatientSex:J,PatientAge:Q,SliceThickness:X,ManufacturerModelName:Z,StudyDate:ee,SeriesDescription:te,SpacingBetweenSlices:ne}=R.current.metadata;return a.createElement(a.Fragment,null,a.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},P&&a.createElement(i.pT,{className:"h-full w-full",totalNumbers:M.totalSegments,percentComplete:M.percentComplete,loadingText:"Loading SEG..."}),B(),$))}m.propTypes={displaySets:s().arrayOf(s().object),viewportId:s().string.isRequired,dataSource:s().object,children:s().node,customProps:s().object},m.defaultProps={customProps:{}};const S=m}}]);
//# sourceMappingURL=295.bundle.ef2fc3b513ca871c3eed.js.map